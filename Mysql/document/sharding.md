分库分表
======

### 1. 概述
#### 1.1 分库分表是什么
#### 1.2 分库分表的方式:

##### 1.2.1 垂直分库

* 垂直分库: `` 按照业务将表进行分类，分布到不同的数据库上面，每个库可以放在不同的服务器上，它的核心理念是专库专用``
  + 解决业务层面的耦合，业务清晰
  + 能对不同业务的数据进行分级管理、维护、监控、扩展等
  + 高并发情景下，垂直分库一定程度的提升IO、数据库连接数、降低单机硬件资源的瓶颈 
    

垂直分库通过将表按业务分类，然后分布在不同的数据库，并且将这些数据库部署在不同的服务器上，从而达到多个服务器分摊压力的效果，但是依然没有解决单表数据量过大的问题
      
##### 1.2.2 水平分库 
* 水平分库 : ``把同一个表的数据按一定规则拆到不同的数据库中,每个库可以放到不同的服务器上``
  + 解决单库大数据,高并发瓶颈
  + 提高了系统的稳定性与可用性

##### 1.2.3 垂直分表  
* 垂直分表 : ``将一个表按照字段分成多表，每个表存储其中一部分字段``
  + 避免IO争抢并减少锁表的几率
  + 充分发挥热点数据操作效率

##### 1.2.4 水平分表
* 水平分表 : `` 在同一个数据库内,把同一个表的数据按一定规则拆到多个表中 ``
  + 优化单一表数据量过大而产生的性能问题
  + 避免IO争抢并减少锁表的几率
库内的水平分表，解决了单一表数据量过大的问题,分出来的小表只包含一部分数据，从而使得单个表的数据量变小，提高检索性能。

##### 1.2.5 小结

垂直分表: ``可以把一个宽表的字段按访问频次、是否是大字段的原则拆分为多个表，这样既能使业务清晰，还能提升部分性能。拆分后，尽量从业务角度避免联查，否则性能方面将得不偿失``  

垂直分库: ``可以把多个表按业务耦合松紧归类，分别存放在不同的库，这些库可以分布在不同服务器，从而使访问压力被多服务器负载，大大提升性能，同时能提高整体架构的业务清晰度，不同的业务库可根据自身情况定制优化方案。但是它需要解决跨库带来的所有复杂问题。`

水平分库: `` ``



<img src="/Users/jimmy/Library/Application Support/typora-user-images/image-20200422155551081.png" alt="image-20200422155551081" style="zoom:50%;" />

#### 1.3 分库分表带来的问题
分库分表能有效的缓解了单机和单库带来的性能瓶颈和压力,突破网络IO、硬件资源、连接数的瓶颈,同时也带来了一些问题
##### 1.3.1 事务一致性的问题
由于分区分表把数据分布在不同的库甚至不同的服务器,不可避免会带来`分布式事务`问题
##### 1.3.2 跨节点关联查询 
在没有分库之前
##### 1.3.3 跨节点分页、排序函数问题
需要将所有节点的进行相应的处理(排序、统计等),然后将各个分片(节点)的结果集进行汇总和再计算,最终将结果返回
##### 1.3.4 主键避重
分库分表环境中,由于数据同时存在不同的数据库中,主键的自增ID将无用武之地,各分区数据无法保证ID唯一.因此需要设计单独设计全局主键,以避免跨库主键重复问题.
##### 1.3.5 公共表
实际场景中,参数表、数据字典表等数据量较少,变动少,而且属于`高频联合查询`的依赖表.例如发货方式表  
可以将这类表在每个数据库都保存一份,所有对公共表的更新操作都同时发送到所有分库执行

### 执行原理
#### 3.1 基本概念
